<!DOCTYPE html>
<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Raleway&family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Latest news</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.js"></script>
    <style>
        body {
            min-height: 100vh;
            margin: 0 auto;
            background-color: #2e2e2e;
        }
        h2,
        h3 {
            margin: 10px;
            font-size: 18px;
        }

        h3 {
            font-size: 19px;
        }

        p {
            margin: 10px;
        }

        .topnav {
        overflow: hidden;
        background-color: #333;
        transition: 0.5s;
        margin-left: 20px;
        display: flex;
        justify-content: center;
        }

        .topnav button {
            float: left;
            color: #f2f2f2;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            font-size: 20px;
            background-color: #333;
            border-color: #333;
            cursor: pointer;
        }

        .topnav button:hover {
            background-color: #ddd;
            color: black;
        }

        .topnav button.active {
            background-color: #05333c;
            color: white;
        }
        .input-group{
            width:28%;
        }
        .mapboxgl-ctrl-geocoder {
            max-width: 30%;
            transition: box-shadow 0.3s ease-in-out;
        }
        .mapboxgl-ctrl-geocoder:hover {
            transition: box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 8px 0 rgba(255, 255, 255, 0.2), 0 6px 20px 0 rgba(255, 255, 255, 0.19);
        }
        #search_box_wrapper{
            display: flex;
            justify-content: center;
            margin:auto;
            width: 100%;
        }
        #textfield{
            display: flex;
            justify-content: center;
            margin:auto;
            width: 60%;
            margin-top:50px;
        }
        .input-group-append
        {
            flex-direction: row-reverse;
        }
        .btn-outline-secondary
        {
            color:#bfc1c5;
        }
        #news-header{
            height: 60px;
            color: #f2f2f2;
            margin: 35px;
        }
        #search-result{
            font-weight: bold;
            font-size: xx-large;
        }
        .content{
            margin: auto;
            height: 80%;
            overflow-y: hidden;
        }
        .parent_post_link{
            text-decoration: none !important;
        }
        .post_image{
            border-radius: 15px;
        }
        .left{
            height: 100%;
            width: 30%;
        }
        
        .post_image{
            height: 100%;
            width: 100%;
            margin: 0;
            padding-left: 0;
            object-fit:cover;
            border-radius: 15px 0% 0% 15px;
        }
        .post{
            display: flex;
            width:60%;
            height: 200px;
            background-color: #646464b4;
            border: 2px solid black; 
            padding: 0px;
            margin:auto;
            margin-top: 25px;
            border-radius: 15px;
        }
        .post_text{
            padding:2px;
            color: #efecec;
            font-family: 'Raleway', sans-serif;
            /* font-family: 'Roboto', sans-serif; */
            font-size: small;
        }
        .post_title{
            color: #efecec;
            text-decoration: none;
            margin-bottom: 10px;
            margin-top: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .post_source{
            color: #efecec;
            font-family: 'Montserrat', sans-serif;
        }
        .right{
            width: 100%;
            height: 100%;
            padding-left: 20px;
            padding-right: 20px;
            margin: auto;
            display: flex;
            flex-direction: column;
        }
        .post_link2{
            text-decoration: none !important;
            display: flex;
            flex-direction: column;
            width: 70%;
        }
        .container_posts{
            display: none;
        }
    </style>
</head>

<body>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
    <div class="topnav">
        <button type="button" id="button1" >Interactive map</button>
        <a href="/news"><button type="button" id="button2" >Latest news</button></a>
        <a href="emergency_contact.ejs"><button type="button" id="button3" >Emergency contact</button></a>
        <a href="my_journal.ejs"><button type="button" id="button4" >Travel journal</button></a>

    </div>
<form action="/logout" method="POST">
    <button type="submit">Log out</button>
</form>
<!-- <div class="input-group mb-3 mx-auto justify-content-center"> -->
<!-- <div class="input-group mb-3 justify-content-center"> -->
<div id="search_box_wrapper">
    <div id="textfield">
        <div id="searchbox" class="input-group-append">
        </div>
        <button id="search-button" class="btn btn-outline-secondary font-weight-bold" type="button">Search</button>
    </div>
            
    </div>
    <!-- <pre id="result"></pre> -->
    <div id="news-header">
        <div id="search-result"></div>
    </div>
    <div class="container_posts">
        <!-- <a class="parent_post_link"> -->
            <div class="post">
                <div class="left">
                    <a class="post_link1"> <img src= ""  alt="image not found" class="post_image"></a>
                </div> 
                <a class="post_link2">
                <div class="right">
                    <div class="content">
                        <span class="post_source"></span>
                        <h3 class="post_title"></h3>
                        <p class="post_text"></p>
                    </div>
                </div>
                </a>
            </div>
        <!-- </a> -->
    </div>
  <!-- </div> -->
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZXNoYWFuZ2FuZXNoMiIsImEiOiJjbDNoNm0za2cxOHJ4M2RwODJrY3ptYW9oIn0.XUCz2-mH68C76R9rmx5TIA';
    const geocoder = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        types: 'country,region,place,postcode,locality,neighborhood'
    });
    
    geocoder.addTo('#searchbox');
    // Get the geocoder results container.
    // const results = document.getElementById('result');
    
    // Add geocoder result to container.
    // geocoder.on('result', (e) => {
    //     results.innerText = JSON.stringify(e.result, null, 2);
    // });
    
    // Clear results container when search is cleared.
    // geocoder.on('clear', () => {
    //     results.innerText = '';
    // });
    //var parentpostlink=document.querySelector(".parent_post_link");
    var postlink1=document.querySelector(".post_link1");
    var post=document.querySelector(".post");
    var postlink2=document.querySelector(".post_link2");
    var postimage=document.querySelector(".post_image");
    var posttitle=document.querySelector(".post_title");
    var posttext=document.querySelector(".post_text");
    var postsource=document.querySelector(".post_source");
    document.querySelector(".mapboxgl-ctrl-geocoder--input").placeholder = "Type location here..";
    document.getElementById("search-button").addEventListener('click',()=>{
        if(document.querySelector(".mapboxgl-ctrl-geocoder--input").value!=""){
            //document.getElementById("search-result").innerText="Showing results for \"\""+document.querySelector(".mapboxgl-ctrl-geocoder--input").value;
            document.getElementById("search-result").innerText=`Showing results for "${document.querySelector(".mapboxgl-ctrl-geocoder--input").value}"`;
            document.getElementById("search-result").style.display="block";
            var url = `https://newsapi.org/v2/everything?` +`q=${document.querySelector(".mapboxgl-ctrl-geocoder--input").value}&` +'from=2022-06-01&' +'sortBy=popularity&' +'apiKey=ad0b5365ba6d42c880344e626ee7b425';
            var req = new Request(url);
            var jsonresponse;
            fetch(req).then(async function(response) {
                jsonresponse= await response.json();
                //console.log(jsonresponse);
                //console.log(jsonresponse.articles);
                document.querySelector(".container_posts").style.display="block";

                //parentpostlink.setAttribute('href',`${jsonresponse.articles[0].url}`);
                postimage.setAttribute("src",`${jsonresponse.articles[0].urlToImage}`);
                postlink1.setAttribute('href',`${jsonresponse.articles[0].url}`);
                postlink1.appendChild(postimage);
                postsource.innerHTML=`${jsonresponse.articles[0].source.name}`;
                postlink2.setAttribute('href',`${jsonresponse.articles[0].url}`);
                posttitle.innerHTML=`${jsonresponse.articles[0].title}`;
                posttext.innerHTML=`${jsonresponse.articles[0].description}`;
                //parentpostlink.appendChild(post);
            });
            document.querySelector(".post").addEventListener('mouseover',()=>{
                posttitle.style.color="#8ab4f8";
            });
            document.querySelector(".post").addEventListener('mouseout',()=>{
                posttitle.style.color="#efecec";
            });
        }
    })
</script>
</body>

</html>